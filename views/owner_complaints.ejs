<%- include('partials/header_sidebar') %>

<style>
    /* Mobile-friendly table and card layout */
    @media (max-width: 767.98px) {
        .table-responsive {
            overflow-x: visible;
        }
        .table {
            font-size: 0.85rem;
        }
        .table td, .table th {
            padding: 0.5rem;
        }
        .btn-sm {
            padding: 0.4rem 0.6rem;
            font-size: 0.7rem;
        }
    }

    @media (max-width: 575.98px) {
        .complaint-card {
            background: #fff;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            border: 1px solid #e9ecef;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .complaint-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
            gap: 8px;
        }
        .complaint-card-title {
            font-size: 0.95rem;
            font-weight: 600;
            color: #1a1a1a;
            margin: 0;
        }
        .complaint-card-subtitle {
            font-size: 0.8rem;
            color: #6c757d;
            margin: 2px 0 0;
        }
        .complaint-card-meta {
            display: flex;
            gap: 8px;
            margin: 10px 0;
            flex-wrap: wrap;
        }
        .complaint-card-meta span {
            font-size: 0.75rem;
            background: #f8f9fa;
            padding: 4px 8px;
            border-radius: 6px;
            color: #555;
        }
        .complaint-card-description {
            font-size: 0.85rem;
            color: #555;
            margin: 10px 0;
            line-height: 1.4;
        }
        .complaint-card-action {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }
        .complaint-card-action button,
        .complaint-card-action a {
            flex: 1;
            padding: 8px 12px;
            font-size: 0.7rem;
            border-radius: 6px;
        }
    }
</style>

<div class="content-wrapper">
    <div class="container-fluid">
        <h2 class="fw-bold mb-4" style="font-family: 'Cinzel';">Hostel Complaints</h2>

        <!-- Desktop View (Table) -->
        <div class="d-none d-md-block">
            <div class="card shadow-sm border-0">
                <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0">
                        <thead class="table-dark">
                            <tr>
                                <th>Student</th>
                                <th>Hostel</th>
                                <th>Issue Type</th>
                                <th>Description</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% if(complaints.length > 0) { %>
                                <% complaints.forEach(comp => { %>
                                    <tr>
                                        <td>
                                            <div class="fw-bold"><%= comp.student_name %></div>
                                            <small class="text-muted"><%= comp.phone %></small>
                                        </td>
                                        <td><%= comp.hostel_name %></td>
                                        <td class="text-danger fw-bold"><%= comp.issue_type %></td>
                                        <td><small><%= comp.description %></small></td>
                                        <td>
                                            <span class="badge bg-<%= comp.status === 'Resolved' ? 'success' : 'warning text-dark' %>">
                                                <%= comp.status %>
                                            </span>
                                        </td>
                                        <td>
                                            <% if(comp.status === 'Pending') { %>
                                                <a href="/resolve_complaint/<%= comp.id %>" class="btn btn-sm btn-outline-success" onclick="return confirm('Mark this issue as resolved?')">
                                                    <i class="bi bi-check-lg"></i> Resolve
                                                </a>
                                            <% } else { %>
                                                <i class="bi bi-check-circle-fill text-success"></i> Fixed
                                            <% } %>
                                        </td>
                                    </tr>
                                <% }) %>
                            <% } else { %>
                                <tr><td colspan="6" class="text-center py-5">No complaints found.</td></tr>
                            <% } %>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Mobile View (Cards) -->
        <div class="d-md-none">
            <% if(complaints.length > 0) { %>
                <% complaints.forEach(comp => { %>
                    <div class="complaint-card">
                        <div class="complaint-card-header">
                            <div>
                                <p class="complaint-card-title"><%= comp.student_name %></p>
                                <p class="complaint-card-subtitle"><%= comp.phone %></p>
                            </div>
                            <span class="badge bg-<%= comp.status === 'Resolved' ? 'success' : 'warning text-dark' %>">
                                <%= comp.status %>
                            </span>
                        </div>

                        <div class="complaint-card-meta">
                            <span><strong><%= comp.hostel_name %></strong></span>
                            <span class="text-danger"><i class="bi bi-exclamation-circle"></i> <%= comp.issue_type %></span>
                        </div>

                        <div class="complaint-card-description">
                            <%= comp.description %>
                        </div>

                        <div class="complaint-card-action">
                            <% if(comp.status === 'Pending') { %>
                                <a href="/resolve_complaint/<%= comp.id %>" class="btn btn-outline-success" onclick="return confirm('Mark this issue as resolved?')">
                                    <i class="bi bi-check-lg"></i> Resolve
                                </a>
                            <% } else { %>
                                <div style="flex: 1; padding: 8px; text-align: center; color: #28a745; font-weight: 600;">
                                    <i class="bi bi-check-circle-fill"></i> Fixed
                                </div>
                            <% } %>
                        </div>
                    </div>
                <% }) %>
            <% } else { %>
                <div class="text-center py-5">
                    <i class="bi bi-inbox fs-1 text-muted opacity-50"></i>
                    <p class="text-muted mt-3">No complaints found.</p>
                </div>
            <% } %>
        </div>

    </div>
</div>
<%- include('partials/footer') %>